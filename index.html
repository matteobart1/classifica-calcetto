<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classifica Presenze Calcetto</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        table { width: 50%; margin: 20px auto; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid #ddd; }
        th { background-color: #f4f4f4; }
    </style>
</head>
<body>

    <h1>Classifica Presenze</h1>
    <table>
        <thead>
            <tr>
                <th>Posizione</th>
                <th>Giocatore</th>
                <th>Presenze</th>
            </tr>
        </thead>
        <tbody id="classifica">
        </tbody>
    </table>

    <script>
        function doGet(e) {
            var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
            var data = sheet.getDataRange().getValues();
            
            var presenze = {};
            
            for (var i = 1; i < data.length; i++) {
                var nome = data[i][1];
                var presente = data[i][2];
        
                if (presente.toLowerCase().trim() === "sÃ¬") {
                    if (!presenze[nome]) {
                        presenze[nome] = 0;
                    }
                    presenze[nome]++;
                }
            }
            
            var classifica = Object.entries(presenze)
                .sort((a, b) => b[1] - a[1])
                .map(item => ({ nome: item[0], presenze: item[1] }));
        
            // Aggiunta delle intestazioni CORS
            var output = ContentService.createTextOutput(JSON.stringify(classifica));
            output.setMimeType(ContentService.MimeType.JSON);
            output.append("\n"); // Risolve un bug con le API di Google Apps Script
        
            var response = output;
            response.setHeader("Access-Control-Allow-Origin", "*");
            response.setHeader("Access-Control-Allow-Methods", "GET");
            response.setHeader("Access-Control-Allow-Headers", "Content-Type");
        
            return response;
}

caricaClassifica();
    </script>

</body>
</html>
